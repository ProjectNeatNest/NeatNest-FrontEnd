#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# ðŸš« Bloquear commits en la rama main
branch="$(git symbolic-ref --short HEAD)"

if [ "$branch" = "main" ]; then
  echo "ðŸš« EstÃ¡ prohibido hacer commits directamente en la rama main."
  exit 1
fi

# âœ¨ Formatear archivos staged con Prettier
echo "ðŸ§¹ Formateando cÃ³digo con Prettier..."

# Obtiene archivos staged que Prettier puede formatear
staged_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|ts|jsx|tsx|json|css|scss|md|html)$')

if [ "$staged_files" ]; then
  bunx prettier --write $staged_files

  # Volver a aÃ±adir los archivos ya formateados al staging
  echo "$staged_files" | xargs git add
else
  echo "âœ… No hay archivos relevantes para formatear."
fi
